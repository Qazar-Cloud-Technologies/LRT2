{% comment %}
Dynamic Grid Menu with Glass Effect and Motorcycle Theme
Includes carousel and collection navigation
All CSS integrated - no external stylesheet needed
{% endcomment %}

{%- style -%}
  /* Motorcycle Carousel Styles */
  .motorcycle-carousel {
    position: relative;
    width: 100%;
    height: 500px;
    overflow: hidden;
    background: #fff;
    margin-bottom: 0px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(0, 0, 0, 0.05);
  }
  
  .carousel-container {
    position: relative;
    width: 100%;
    height: 100%;
  }
  
  .carousel-track {
    display: flex;
    transition: transform 0.5s ease;
    height: 100%;
    width: 200%; /* Width for 2 slides */
  }
  
  .carousel-slide {
    position: relative;
    width: 50%; /* Each slide takes 50% of track width */
    height: 100%;
    flex-shrink: 0;
  }
  
  .carousel-slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .carousel-overlay {
    display: none; /* Content moved to unified left panel */
  }
  
  .carousel-title {
    font-family: monospace;
    font-size: 3rem;
    font-weight: 900;
    color: #ffffff;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    margin: 0;
    text-shadow: 
      2px 2px 4px rgba(0, 0, 0, 0.8),
      0 0 20px rgba(255, 0, 0, 0.6),
      0 0 40px rgba(255, 0, 0, 0.4);
    animation: pulse-glow 6s ease-in-out infinite;
    will-change: opacity, text-shadow;
    transform: translateZ(0); /* Hardware acceleration */
    background: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0.7),
      transparent
    );
    padding: 10px 20px;
    border-radius: 10px;
    display: inline-block;
  }
  
  @keyframes pulse-glow {
    0%, 100% {
      text-shadow: 
        2px 2px 4px rgba(0, 0, 0, 0.8),
        0 0 20px rgba(255, 0, 0, 0.6),
        0 0 40px rgba(255, 0, 0, 0.4);
    }
    50% {
      text-shadow: 
        2px 2px 4px rgba(0, 0, 0, 0.8),
        0 0 30px rgba(255, 0, 0, 0.8),
        0 0 50px rgba(255, 0, 0, 0.6);
    }
  }
  
  .carousel-subtitle {
    font-family: monospace;
    font-size: 1.2rem;
    color: #ffffff;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-top: 10px;
    text-shadow: 
      1px 1px 3px rgba(0, 0, 0, 0.8),
      0 0 10px rgba(255, 0, 0, 0.5);
    background: rgba(0, 0, 0, 0.6);
    padding: 5px 15px;
    border-radius: 8px;
    display: inline-block;
  }
  
  .carousel-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 0, 0, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 0, 0, 0.3);
    color: #ff0000;
    font-size: 2rem;
    padding: 10px 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 3;
  }
  
  .carousel-nav:hover {
    background: rgba(255, 0, 0, 0.2);
    box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
  }
  
  /* Navigation buttons removed - auto-advance only */
  
  /* Carousel dots removed - clean auto-advance only */
  
  /* Unified Left Panel - Content-sized with high transparency */
  .info-container {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    left: 30px;
    width: 33.33%;
    max-width: 400px;
    background: rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(3px) saturate(110%);
    -webkit-backdrop-filter: blur(3px) saturate(110%);
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 12px;
    padding: 25px 30px;
    z-index: 10;
    color: white;
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }

  /* New styles for unified panel content - better spacing */
  .panel-title {
    font-family: monospace;
    font-size: 1.17em;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin: 0 0 12px 0;
    color: #ffffff;
    text-shadow: 
      3px 3px 8px rgba(0, 0, 0, 1),
      0 0 30px rgba(255, 0, 0, 0.6),
      0 0 60px rgba(255, 0, 0, 0.3);
    animation: pulse-glow 6s ease-in-out infinite;
    line-height: 1.1;
  }
  
  .panel-subtitle {
    font-family: monospace;
    font-size: 0.9em;
    color: #ffffff;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin: 0 0 25px 0;
    text-shadow: 2px 2px 6px rgba(0, 0, 0, 1);
  }
  
  .panel-divider {
    width: 60px;
    height: 2px;
    background: linear-gradient(to right, #ff0000, rgba(255, 0, 0, 0.2));
    margin: 20px 0;
    box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
  }

  .info-title {
    font-family: monospace;
    font-size: 0.9em;
    color: #ffffff;
    text-transform: uppercase;
    margin: 15px 0 10px 0;
    text-shadow: 
      2px 2px 6px rgba(0, 0, 0, 1),
      0 0 15px rgba(255, 0, 0, 0.5);
    letter-spacing: 0.06em;
    border-left: 3px solid #ff0000;
    padding-left: 10px;
  }

  .info-highlight {
    display: inline-block;
    background: linear-gradient(135deg, rgba(255, 0, 0, 0.3), rgba(255, 0, 0, 0.2));
    color: #ffffff;
    font-family: monospace;
    font-size: 0.9em;
    text-transform: uppercase;
    font-weight: bold;
    padding: 5px 12px;
    border: 1px solid #ff0000;
    border-radius: 6px;
    margin: 10px 0 15px 0;
    text-decoration: none;
    text-transform: uppercase;
    transition: all 0.3s ease;
    text-shadow: 2px 2px 6px rgba(0, 0, 0, 1);
    box-shadow: 
      0 2px 10px rgba(255, 0, 0, 0.4),
      inset 0 0 20px rgba(255, 0, 0, 0.2);
    letter-spacing: 0.06em;
  }

  .info-highlight:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 25px rgba(255, 0, 0, 0.6);
    background: linear-gradient(135deg, #ff3333, #ff0000);
  }

  .info-description {
    color: #ffffff;
    font-size: 0.9em;
    margin-top: 15px;
    line-height: 1.5;
    font-weight: 500;
    text-shadow: 2px 2px 6px rgba(0, 0, 0, 1);
    font-style: normal;
    text-transform: uppercase;
  }

  .info-list {
    list-style: none;
    padding: 0;
    margin: 12px 0 15px 0;
  }

  .info-list li {
    color: #ffffff;
    font-size: 0.9em;
    margin: 8px 0;
    padding-left: 18px;
    position: relative;
    text-shadow: 2px 2px 6px rgba(0, 0, 0, 1);
    text-transform: uppercase;
  }

  .info-list li::before {
    content: 'â–¸';
    position: absolute;
    left: 0;
    color: #ff0000;
    font-weight: bold;
    text-shadow: 0 0 8px rgba(255, 0, 0, 0.6);
  }

  /* Tablet-specific styles (769px to 1024px) */
  @media (min-width: 769px) and (max-width: 1024px) {
    /* Hide menu on tablet */
    .grid-category-menu {
      display: none !important;
    }
    
    /* Search bar centered and at bottom of nav */
    .header-search {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      width: 60%;
      z-index: 100;
    }
    
    /* Service cards in single column */
    .services-grid {
      grid-template-columns: 1fr !important;
      max-width: 600px;
      margin: 0 auto;
    }
    
    /* More space below company intro */
    .company-intro {
      margin-bottom: 60px !important;
    }
    
    /* Service card adjustments for tablet */
    .service-card {
      max-width: none;
      padding: 30px;
    }
    
    .service-image {
      height: 400px;
    }
  }

  @media (max-width: 768px) {
    /* Disable heavy animations on mobile for better performance */
    .grid-category-menu::before,
    .featured-item::before,
    .promo-banner::before {
      animation-duration: 30s !important; /* Much slower */
      animation-delay: 1s; /* Add delay to reduce initial load */
    }
    
    /* Disable gradient animations on mobile */
    .grid-menu-link {
      animation: none !important;
      background-size: 100% 100% !important;
    }
    
    /* Adjust grid-category-menu margin for mobile */
    .grid-category-menu {
      margin: 60px auto 30px auto;
    }
    
    .motorcycle-carousel {
      height: 300px;
    }
    
    .carousel-title {
      font-size: 2rem;
    }
    
    .carousel-subtitle {
      font-size: 1rem;
    }
    
    .info-container {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      left: 15px;
      width: 40%;
      max-width: 30%;
      right: auto;
      min-width: unset;
      padding: 4px;
      background: rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .panel-title {
      font-size: 0.884em;
      line-height: 1;
      margin: 0 0 8px 0;
    }
    
    .panel-subtitle {
      font-size: 0.68em;
      margin: 0 0 12px 0;
    }
    
    .panel-divider {
      margin: 10px 0;
    }
    
    .info-title {
      font-size: 0.68em;
      margin: 8px 0 6px 0;
      border-left: none;
      padding-left: 0;
      text-align: center;
    }
    
    .info-highlight {
      font-size: 0.68em;
      padding: 3px 8px;
      margin: 6px 0 8px 0;
    }
    
    .info-description {
      font-size: 0.68em;
      margin-top: 8px;
    }
    
    .info-list {
      margin: 8px 0;
    }
    
    .info-list {
      text-align: center;
      width: 100%;
    }
    
    .info-list li {
      font-size: 0.68em;
      margin: 5px 0;
      text-align: center;
      padding-left: 0;
    }
    
    .info-list li::before {
      display: none;
    }
  }

  /* Promo Banner Styles */
  .promo-banner {
    width: 95%;
    margin: 12px auto;
    background: linear-gradient(
      90deg,
      rgba(20, 20, 20, 0.95) 0%,
      rgba(255, 0, 0, 0.15) 20%,
      rgba(255, 0, 0, 0.25) 50%,
      rgba(255, 0, 0, 0.15) 80%,
      rgba(20, 20, 20, 0.95) 100%
    );
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 0, 0, 0.4);
    border-radius: 10px;
    padding: 8px 15px;
    position: relative;
    overflow: hidden;
    box-shadow: 
      0 4px 20px rgba(255, 0, 0, 0.2),
      0 2px 10px rgba(0, 0, 0, 0.4),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
  }

  .promo-banner::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent 0%,
      rgba(255, 0, 0, 0.4) 50%,
      transparent 100%
    );
    animation: promo-shine 6s infinite;
  }

  @keyframes promo-shine {
    0% { left: -100%; }
    100% { left: 100%; }
  }

  .promo-banner-content {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    position: relative;
    z-index: 2;
  }

  .promo-banner-text {
    font-family: monospace;
    font-size: 0.9em;
    color: #ffffff;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 700;
    text-align: center;
    text-shadow: 0 0 8px rgba(255, 0, 0, 0.5);
    animation: promo-pulse 4s ease-in-out infinite;
  }

  @keyframes promo-pulse {
    0%, 100% {
      text-shadow: 
        0 0 10px rgba(255, 0, 0, 0.5),
        0 0 20px rgba(255, 0, 0, 0.3);
    }
    50% {
      text-shadow: 
        0 0 15px rgba(255, 0, 0, 0.8),
        0 0 30px rgba(255, 0, 0, 0.5);
    }
  }

  .promo-code-highlight {
    display: inline-block;
    background: linear-gradient(135deg, #ff0000, #cc0000);
    color: #fff;
    padding: 2px 8px;
    border-radius: 5px;
    margin: 0 5px;
    font-weight: 900;
    box-shadow: 0 2px 10px rgba(255, 0, 0, 0.4);
    animation: code-glow 4s ease-in-out infinite;
  }

  @keyframes code-glow {
    0%, 100% {
      box-shadow: 0 2px 10px rgba(255, 0, 0, 0.4);
      transform: scale(1);
    }
    50% {
      box-shadow: 0 4px 15px rgba(255, 0, 0, 0.6);
      transform: scale(1.03);
    }
  }

  @media (max-width: 768px) {
    .promo-banner {
      padding: 6px 10px;
      margin: 16px auto;
    }

    .promo-banner-text {
      font-size: 0.68em;
    }

    .promo-banner-content {
      flex-direction: row;
      gap: 5px;
    }

    .promo-code-highlight {
      margin: 2px;
      padding: 2px 6px;
    }
  }

  /* Mega Menu Styles with 95% width */
  
  /* Main container with enhanced glass effect */
  .grid-category-menu {
    width: 95%;
    padding: 16px 0;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.95) 0%,
      rgba(250, 250, 250, 0.98) 50%,
      rgba(255, 255, 255, 0.95) 100%
    );
    backdrop-filter: blur(30px) saturate(150%);
    -webkit-backdrop-filter: blur(30px) saturate(150%);
    border: 1px solid rgba(255, 0, 0, 0.2);
    border-radius: 20px;
    box-shadow: 
      0 12px 48px rgba(255, 0, 0, 0.1),
      0 4px 16px rgba(0, 0, 0, 0.1),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.5),
      inset 0 -1px 0 0 rgba(0, 0, 0, 0.1);
    margin: 80px auto 40px auto;
    position: relative;
    overflow: visible;
    z-index: 30000 !important;
  }

  /* Add Matrix-style overlay with red accent */
  .grid-category-menu::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(255, 0, 0, 0.03) 2px,
      rgba(255, 0, 0, 0.03) 4px
    );
    pointer-events: none;
    border-radius: 20px;
    opacity: 0.6;
    animation: matrix-scan 15s linear infinite;
    will-change: transform;
    transform: translateZ(0); /* Enable GPU acceleration */
  }

  @keyframes matrix-scan {
    0% { transform: translateY(0); }
    100% { transform: translateY(20px); }
  }

  /* Auto-fit grid with minimum item width and max 6 columns */
  .grid-menu-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    grid-auto-rows: minmax(auto, auto);
    gap: 4px;
    padding: 0px;
    margin: 0;
    list-style: none;
    position: relative;
    z-index: 10;
    overflow: visible;
  }

  /* Limit to maximum 6 columns */
  @media (min-width: 860px) {
    .grid-menu-container {
      grid-template-columns: repeat(6, 1fr);
    }
  }

  .grid-menu-item {
    position: relative;
    margin: 0;
    padding: 0;
    border-radius: 12px;
    min-width: 0;
    margin-bottom: 0;
  }

  /* Remove margin for items with children - dropdowns will overlay */
  .grid-menu-item.has-children {
    margin-bottom: 0;
  }

  /* Show dropdown on hover for desktop */
  @media (min-width: 769px) {
    .grid-menu-item.has-children:hover .grid-dropdown,
    .grid-menu-item.has-children:focus-within .grid-dropdown {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
      transform: translateY(0) scale(1);
    }
  }
  
  /* Mobile: Show dropdown when active class is added via JS */
  @media (max-width: 768px) {
    .grid-menu-item.has-children.mobile-active .grid-dropdown {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
      transform: translateY(0) scale(1);
    }
    
    /* Visual feedback when submenu is open on mobile */
    .grid-menu-item.has-children.mobile-active .grid-menu-link {
      background: linear-gradient(
        135deg,
        rgba(255, 0, 0, 0.25) 0%,
        rgba(255, 0, 0, 0.4) 50%,
        rgba(255, 0, 0, 0.25) 100%
      );
      border-color: rgba(255, 0, 0, 0.6);
      box-shadow: 
        0 6px 24px rgba(255, 0, 0, 0.3),
        0 3px 12px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 0 rgba(255, 255, 255, 0.2);
    }
    
    /* Add a small arrow or indicator for categories with children on mobile */
    .grid-menu-item.has-children .grid-menu-link::before {
      content: 'â–¼';
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 0.7em;
      color: rgba(255, 0, 0, 0.6);
      transition: transform 0.3s ease;
    }
    
    .grid-menu-item.has-children.mobile-active .grid-menu-link::before {
      transform: translateY(-50%) rotate(180deg);
      color: rgba(255, 0, 0, 1);
    }
  }

  /* Ensure hovered menu item is above others */
  .grid-menu-item.has-children:hover {
    z-index: 9999;
  }

  /* Create invisible bridge to maintain hover state */
  .grid-menu-item.has-children::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    height: 10px;
    z-index: 99;
  }

  /* Enhanced gradient animated button style with Matrix effect */
  .grid-menu-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: 12px 8px;
    color: #ffffff;
    text-decoration: none;
    font-size: inherit;
    font-weight: 700;
    text-transform: uppercase;
    border-radius: 14px;
    position: relative;
    overflow: hidden;
    
    /* Enhanced gradient animation */
    background: linear-gradient(
      135deg,
      rgba(255, 0, 0, 0.1) 0%,
      rgba(255, 0, 0, 0.2) 25%,
      rgba(0, 0, 0, 0.6) 50%,
      rgba(255, 0, 0, 0.2) 75%,
      rgba(255, 0, 0, 0.1) 100%
    );
    background-size: 300% 300%;
    animation: gradient-shift 20s ease infinite;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    
    /* Enhanced glass effect */
    backdrop-filter: blur(15px) brightness(1.1);
    -webkit-backdrop-filter: blur(15px) brightness(1.1);
    border: 1px solid rgba(255, 0, 0, 0.3);
    box-shadow: 
      0 4px 16px rgba(255, 0, 0, 0.1),
      0 2px 8px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
  }

  @keyframes gradient-shift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* Featured Categories Styles - Matrix Animated */
  .featured-categories {
    width: 95%;
    margin: 20px auto;
    padding: 0;
  }

  .featured-categories-title {
    font-family: monospace;
    font-size: 1.8em;
    font-weight: 900;
    color: #ff0000;
    text-transform: uppercase;
    text-align: center;
    margin-bottom: 15px;
    letter-spacing: 0.5em;
    position: relative;
    background: linear-gradient(
      135deg,
      #ff0000,
      #ff3333,
      #ff0000,
      #cc0000
    );
    background-size: 300% 300%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradient-flow 4s ease-in-out infinite, pulse-glow-title 6s ease-in-out infinite;
    display: inline-block;
    width: 100%;
    padding: 15px 0;
    filter: drop-shadow(0 0 20px rgba(255, 0, 0, 0.5)) 
            drop-shadow(0 0 40px rgba(255, 0, 0, 0.3));
  }

  @keyframes gradient-flow {
    0% { 
      background-position: 0% 50%; 
    }
    50% { 
      background-position: 100% 50%; 
    }
    100% { 
      background-position: 0% 50%; 
    }
  }
  
  @keyframes pulse-glow-title {
    0%, 100% {
      filter: drop-shadow(0 0 20px rgba(255, 0, 0, 0.5)) 
              drop-shadow(0 0 40px rgba(255, 0, 0, 0.3));
      transform: scale(1);
    }
    50% {
      filter: drop-shadow(0 0 30px rgba(255, 0, 0, 0.8)) 
              drop-shadow(0 0 60px rgba(255, 0, 0, 0.5));
      transform: scale(1.01);
    }
  }
  
  /* Add subtle shine effect */
  .featured-categories-title::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.2),
      transparent
    );
    animation: shine-slide 8s ease-in-out infinite;
  }
  
  @keyframes shine-slide {
    0% { left: -100%; }
    50%, 100% { left: 100%; }
  }
  
  /* Services Title - Same style as featured categories */
  .services-title {
    font-family: monospace;
    font-size: 1.8em;
    font-weight: 900;
    color: #ff0000;
    text-transform: uppercase;
    text-align: center;
    margin: 40px auto 15px auto;
    letter-spacing: 0.5em;
    position: relative;
    background: linear-gradient(
      135deg,
      #ff0000,
      #ff3333,
      #ff0000,
      #cc0000
    );
    background-size: 300% 300%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: gradient-flow 4s ease-in-out infinite, pulse-glow-title 6s ease-in-out infinite;
    display: inline-block;
    width: 100%;
    padding: 15px 0;
    filter: drop-shadow(0 0 20px rgba(255, 0, 0, 0.5)) 
            drop-shadow(0 0 40px rgba(255, 0, 0, 0.3));
  }
  
  /* Add shine effect for services title */
  .services-title::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.2),
      transparent
    );
    animation: shine-slide 8s ease-in-out infinite;
  }

  .featured-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    width: 100%;
  }

  .featured-item {
    position: relative;
    aspect-ratio: 16 / 9;
    overflow: hidden;
    border-radius: 14px;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.95) 0%,
      rgba(250, 250, 250, 0.98) 50%,
      rgba(255, 255, 255, 0.95) 100%
    );
    backdrop-filter: blur(30px) saturate(150%);
    border: 2px solid rgba(255, 0, 0, 0.3);
    transition: all 0.3s ease;
    cursor: pointer;
    display: block;
    box-shadow: 
      0 8px 32px rgba(255, 0, 0, 0.1),
      0 4px 16px rgba(0, 0, 0, 0.1);
  }

  .featured-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(255, 0, 0, 0.03) 2px,
      rgba(255, 0, 0, 0.03) 4px
    );
    pointer-events: none;
    z-index: 2;
    opacity: 0.6;
    animation: matrix-scan 15s linear infinite;
  }

  .featured-item:hover {
    transform: translateY(-5px) scale(1.02);
    box-shadow: 
      0 12px 48px rgba(255, 0, 0, 0.4),
      0 6px 24px rgba(0, 0, 0, 0.5);
    border-color: rgba(255, 0, 0, 0.6);
  }

  .featured-item img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    transition: transform 0.5s ease;
  }

  .featured-item:hover img {
    transform: scale(1.1);
  }

  .featured-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 20px;
    background: linear-gradient(
      to top, 
      rgba(0, 0, 0, 0.95) 0%, 
      rgba(0, 0, 0, 0.8) 50%,
      transparent 100%
    );
    color: #fff;
    z-index: 3;
  }

  .featured-title {
    font-family: monospace;
    font-size: 1.3rem;
    font-weight: bold;
    text-transform: uppercase;
    margin: 0;
    color: #ffffff;
    text-shadow: 0 0 10px rgba(255, 0, 0, 0.8);
    position: relative;
    letter-spacing: 0.1em;
  }

  /* Animated matrix glitch effect for featured titles */
  .featured-title::before {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    color: #ff0000;
    opacity: 0;
    animation: glitch-featured 4s infinite;
    clip-path: polygon(0 0, 100% 0, 100% 45%, 0 45%);
    transform: translate(-2px, -2px);
  }

  @keyframes glitch-featured {
    0%, 100% {
      opacity: 0;
    }
    33% {
      opacity: 0.5;
      transform: translate(-2px, -2px);
    }
    66% {
      opacity: 0.5;
      transform: translate(2px, 2px);
    }
  }

  @media (max-width: 768px) {
    .featured-categories {
      margin: 0px auto;
    }
    
    .featured-grid {
      grid-template-columns: 1fr;
      gap: 15px;
    }
    
    .featured-categories-title,
    .services-title {
      font-size: 1.36em;
      letter-spacing: 0.3em;
      padding: 8px 0;
      margin-bottom: 10px;
    }
    
    .services-title {
      margin-top: 16px;
    }
    
    .featured-title {
      font-size: 1.1rem;
    }
  }

  /* Company Info Section */
  .company-section {
    width: 95%;
    margin: 2px auto;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.95) 0%,
      rgba(250, 250, 250, 0.98) 50%,
      rgba(255, 255, 255, 0.95) 100%
    );
    backdrop-filter: blur(30px) saturate(150%);
    border: 1px solid rgba(255, 0, 0, 0.2);
    border-radius: 20px;
    padding: 6px;
    box-shadow: 
      0 12px 48px rgba(255, 0, 0, 0.1),
      0 4px 16px rgba(0, 0, 0, 0.1);
  }

  .company-title {
    font-family: monospace;
    font-size: 2.5rem;
    color: #ff0000;
    text-transform: uppercase;
    text-align: center;
    margin-bottom: 30px;
    text-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
    letter-spacing: 0.2em;
  }

  .services-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: repeat(2, 1fr);
    gap: 30px;
    margin-bottom: 40px;
  }

  .service-card {
    background: linear-gradient(
      90deg,
      rgba(255, 255, 255, 0.95) 0%,
      rgba(255, 245, 245, 0.98) 20%,
      rgba(255, 250, 250, 0.95) 50%,
      rgba(255, 245, 245, 0.98) 80%,
      rgba(255, 255, 255, 0.95) 100%
    );
    backdrop-filter: blur(20px) saturate(120%);
    -webkit-backdrop-filter: blur(20px) saturate(120%);
    border: 2px solid rgba(255, 0, 0, 0.25);
    border-radius: 16px;
    padding: 25px;
    text-align: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 
      0 6px 24px rgba(255, 0, 0, 0.08),
      0 2px 8px rgba(0, 0, 0, 0.05),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.8),
      inset 0 -1px 0 0 rgba(255, 0, 0, 0.1);
  }
  
  /* Add animated shine effect */
  .service-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent 0%,
      rgba(255, 0, 0, 0.1) 50%,
      transparent 100%
    );
    animation: service-shine 8s infinite;
    z-index: 1;
  }
  
  /* Add subtle pattern overlay */
  .service-card::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: repeating-linear-gradient(
      45deg,
      transparent,
      transparent 10px,
      rgba(255, 0, 0, 0.01) 10px,
      rgba(255, 0, 0, 0.01) 20px
    );
    pointer-events: none;
    opacity: 0.5;
    z-index: 0;
  }
  
  @keyframes service-shine {
    0% { left: -100%; }
    50%, 100% { left: 100%; }
  }
  
  /* Ensure content appears above the effects */
  .service-card > * {
    position: relative;
    z-index: 2;
  }
  
  .service-image {
    width: 100%;
    height: 350px;
    object-fit: contain;
    border-radius: 12px;
    margin-bottom: 20px;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    border: 2px solid rgba(255, 0, 0, 0.1);
    box-shadow: 
      0 4px 15px rgba(255, 0, 0, 0.05),
      0 2px 6px rgba(0, 0, 0, 0.08);
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.9),
      rgba(255, 250, 250, 0.9)
    );
    padding: 5px;
  }

  .service-card:hover {
    transform: translateY(-8px) scale(1.02);
    box-shadow: 
      0 12px 40px rgba(255, 0, 0, 0.2),
      0 8px 20px rgba(0, 0, 0, 0.1),
      inset 0 2px 0 0 rgba(255, 0, 0, 0.2),
      inset 0 -2px 0 0 rgba(255, 0, 0, 0.15);
    background: linear-gradient(
      90deg,
      rgba(255, 245, 245, 0.98) 0%,
      rgba(255, 235, 235, 1) 20%,
      rgba(255, 240, 240, 0.98) 50%,
      rgba(255, 235, 235, 1) 80%,
      rgba(255, 245, 245, 0.98) 100%
    );
    border-color: rgba(255, 0, 0, 0.4);
  }
  
  /* Stop the shine animation on hover for better visibility */
  .service-card:hover::before {
    animation-play-state: paused;
    opacity: 0.5;
    left: 0;
  }
  
  /* Enhance pattern on hover */
  .service-card:hover::after {
    opacity: 0.8;
  }
  
  .service-card:hover .service-image {
    transform: scale(1.08) rotate(1deg);
    filter: brightness(1.05) contrast(1.1);
  }


  .service-title {
    font-family: monospace;
    font-size: 1.8em;
    margin-bottom: 15px;
    margin-top: 10px;
    text-transform: uppercase;
    font-weight: 900;
    letter-spacing: 0.5em;
    position: relative;
    padding-bottom: 10px;
    
    /* Gradient text effect */
    background: linear-gradient(
      135deg,
      #ff0000 0%,
      #ff3333 50%,
      #ff0000 100%
    );
    background-size: 200% 200%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: title-gradient 4s ease-in-out infinite;
    
    /* Add glow effect */
    filter: drop-shadow(0 0 8px rgba(255, 0, 0, 0.3));
  }
  
  @keyframes title-gradient {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }
  
  /* Add decorative underline */
  .service-title::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 60%;
    height: 2px;
    background: linear-gradient(
      90deg,
      transparent 0%,
      rgba(255, 0, 0, 0.6) 20%,
      rgba(255, 0, 0, 0.8) 50%,
      rgba(255, 0, 0, 0.6) 80%,
      transparent 100%
    );
    border-radius: 2px;
  }
  
  /* Enhance title on card hover */
  .service-card:hover .service-title {
    animation-duration: 2s;
    filter: drop-shadow(0 0 12px rgba(255, 0, 0, 0.5));
  }

  .service-description {
    color: #444;
    line-height: 1.7;
    font-size: 0.912em;
    font-weight: 500;
    padding: 10px 15px;
    margin-top: 10px;
    position: relative;
    background: rgba(255, 255, 255, 0.6);
    border-radius: 8px;
    border-left: 3px solid rgba(255, 0, 0, 0.2);
    transition: all 0.3s ease;
  }
  
  /* Enhance description on hover */
  .service-card:hover .service-description {
    background: rgba(255, 255, 255, 0.9);
    border-left-color: rgba(255, 0, 0, 0.4);
    transform: translateX(5px);
    color: #222;
  }

  .company-intro {
    text-align: center;
    color: #333;
    line-height: 1.8;
    font-size: 1.14em;
    max-width: 800px;
    margin: 0 60px 40px 60px;
    padding: 30px 40px;
    background: rgba(255, 255, 255, 0.5);
    border-radius: 10px;
    display: block;
    margin-left: auto;
    margin-right: auto;
  }

  /* Opening Hours Styles */
  .opening-hours {
    text-align: center;
    margin: 40px auto 30px auto;
    padding: 25px;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.5) 0%,
      rgba(255, 250, 250, 0.6) 50%,
      rgba(255, 255, 255, 0.5) 100%
    );
    border-radius: 12px;
    border-left: 4px solid rgba(255, 0, 0, 0.3);
    max-width: 500px;
  }

  .hours-title {
    font-family: monospace;
    font-size: 1.3em;
    font-weight: 900;
    color: #ff0000;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    margin-bottom: 20px;
    text-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
  }

  .hours-content {
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  .hours-text {
    font-family: monospace;
    font-size: 0.95em;
    color: #444;
    font-weight: 600;
    letter-spacing: 0.05em;
    margin: 0;
    padding: 5px 0;
    border-bottom: 1px dotted rgba(255, 0, 0, 0.2);
  }

  .hours-text:last-child {
    border-bottom: none;
  }

  .social-links {
    display: flex;
    justify-content: center;
    gap: 25px;
    margin-top: 30px;
    margin-bottom: 20px;
  }

  .social-link {
    display: inline-block;
    width: 60px;
    height: 60px;
    background: rgba(255, 255, 255, 0.95);
    border: 2px solid rgba(255, 0, 0, 0.3);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    transition: all 0.3s ease;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    overflow: hidden;
  }

  .social-link img {
    width: 30px;
    height: 30px;
    object-fit: contain;
    transition: all 0.3s ease;
  }

  .social-link:hover {
    background: rgba(255, 240, 240, 1);
    transform: translateY(-5px) scale(1.1);
    box-shadow: 0 8px 25px rgba(255, 0, 0, 0.3);
    border-color: rgba(255, 0, 0, 0.5);
  }

  .social-link:hover img {
    transform: scale(1.2);
  }

  @media (max-width: 768px) {
    .opening-hours {
      margin: 30px 20px 20px 20px;
      padding: 20px;
    }

    .hours-title {
      font-size: 1.1em;
      margin-bottom: 15px;
    }

    .hours-text {
      font-size: 0.85em;
    }

    .social-links {
      gap: 15px;
      margin-top: 20px;
    }

    .social-link {
      width: 50px;
      height: 50px;
    }

    .social-link img {
      width: 25px;
      height: 25px;
    }
  }

  /* Help Button Styles */
  .help-button-container {
    display: flex;
    justify-content: center;
    margin-top: 30px;
    margin-bottom: 40px;
  }

  .help-button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 15px 30px;
    background: linear-gradient(135deg, #ff0000, #cc0000);
    color: white;
    border: none;
    border-radius: 30px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3);
  }

  .help-button:hover {
    background: linear-gradient(135deg, #ff1111, #dd0000);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255, 0, 0, 0.4);
  }

  .help-button:active {
    transform: translateY(0);
  }

  .help-button svg {
    width: 20px;
    height: 20px;
  }

  @media (max-width: 768px) {
    .help-button {
      padding: 12px 25px;
      font-size: 14px;
    }
  }

  @media (max-width: 768px) {
    .services-grid {
      grid-template-columns: 1fr;
      grid-template-rows: auto;
      gap: 20px;
    }

    .company-section {
      padding: 6px;
    }

    .company-title {
      font-size: 1.8rem;
    }
    
    .company-intro {
      font-size: 1.14em;
      margin: 0 20px 30px 20px;
      padding: 20px 25px;
    }
    
    .service-description {
      font-size: 0.912em;
    }
    
    .service-title {
      font-size: 1.36em;
      letter-spacing: 0.3em;
    }
  }

  /* All Products special styling */
  .grid-menu-item.all-products .grid-menu-link {
    background: linear-gradient(
      135deg,
      rgba(255, 0, 0, 0.3) 0%,
      rgba(255, 0, 0, 0.5) 50%,
      rgba(255, 0, 0, 0.3) 100%
    );
    border-color: rgba(255, 0, 0, 0.5);
    box-shadow: 
      0 4px 20px rgba(255, 0, 0, 0.3),
      0 2px 8px rgba(0, 0, 0, 0.4),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.2);
  }

  /* Empty slot styling */
  .grid-menu-item.empty-slot .placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: 12px 8px;
    color: rgba(255, 255, 255, 0.3);
    font-size: inherit;
    font-weight: 600;
    text-transform: uppercase;
    border-radius: 14px;
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px dashed rgba(255, 0, 0, 0.2);
    cursor: not-allowed;
    opacity: 0.5;
  }

  .grid-menu-link:hover,
  .grid-menu-link:focus {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 
      0 8px 32px rgba(255, 0, 0, 0.4),
      0 4px 16px rgba(0, 0, 0, 0.5),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.3),
      0 0 40px rgba(255, 0, 0, 0.3);
    border-color: rgba(255, 0, 0, 0.6);
    outline: none;
  }

  /* Matrix text effect on hover */
  .grid-menu-link::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ff0000;
    opacity: 0;
    transition: opacity 0.3s ease;
    text-shadow: 0 0 10px #ff0000;
    pointer-events: none;
  }

  .grid-menu-link:hover::after {
    opacity: 0.1;
    animation: glitch-text 2s infinite;
  }

  @keyframes glitch-text {
    0%, 100% { transform: translate(0); }
    33% { transform: translate(-2px, -2px); }
    66% { transform: translate(2px, 2px); }
  }

  /* Active state */
  .grid-menu-link:active {
    transform: translateY(0);
    box-shadow: 
      0 2px 8px rgba(0, 0, 0, 0.08),
      inset 0 1px 2px rgba(0, 0, 0, 0.1);
  }

  .menu-text {
    font-size: 0.9em;
    letter-spacing: 1px;
    white-space: nowrap;
    line-height: 1.4;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: center;
    font-family: monospace, 'Courier New', Courier;
    text-shadow: 0 0 5px rgba(255, 0, 0, 0.3);
    position: relative;
    z-index: 2;
  }

  /* Mobile font size adjustment */
  @media (max-width: 600px) {
    .menu-text {
      font-size: 0.68em;
      letter-spacing: 0.5px;
      line-height: 1.2;
    }
  }

  /* Enhanced glass dropdown with Matrix styling */
  .grid-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    width: 100%;
    z-index: 40000 !important;
    max-height: 300px;
    overflow-y: auto;
    background: linear-gradient(
      to bottom,
      rgba(60, 60, 60, 0.95) 0%,
      rgba(80, 80, 80, 0.98) 100%
    );
    backdrop-filter: blur(30px) brightness(1.1);
    -webkit-backdrop-filter: blur(30px) brightness(1.1);
    box-shadow: 
      0 12px 48px rgba(255, 0, 0, 0.15),
      0 4px 16px rgba(0, 0, 0, 0.15),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.5);
    border-radius: 14px;
    border: 1px solid rgba(255, 0, 0, 0.3);
    list-style: none;
    padding: 8px;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transform: translateY(-5px) scale(0.98);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 0, 0, 0.3) transparent;
  }

  /* Custom scrollbar for webkit browsers */
  .grid-dropdown::-webkit-scrollbar {
    width: 6px;
  }

  .grid-dropdown::-webkit-scrollbar-track {
    background: transparent;
  }

  .grid-dropdown::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 3px;
  }

  .grid-dropdown::-webkit-scrollbar-thumb:hover {
    background-color: rgba(0, 0, 0, 0.3);
  }

  .grid-dropdown li {
    margin: 0 0 2px 0;
    padding: 0;
  }

  .grid-dropdown li:last-child {
    margin-bottom: 0;
  }

  .grid-dropdown a {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 10px 12px;
    color: #ffffff;
    text-decoration: none;
    font-size: 0.85em;
    font-weight: 600;
    text-transform: uppercase;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.05);
    transition: all 0.2s ease;
    white-space: nowrap;
    font-family: monospace, 'Courier New', Courier;
    border: 1px solid transparent;
    text-shadow: 0 0 3px rgba(255, 0, 0, 0.2);
  }

  .grid-dropdown a:hover,
  .grid-dropdown a:focus {
    background: linear-gradient(
      to right,
      rgba(255, 0, 0, 0.3),
      rgba(255, 0, 0, 0.5)
    );
    color: #fff;
    transform: translateX(6px);
    box-shadow: 
      0 4px 16px rgba(255, 0, 0, 0.4),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 0, 0, 0.5);
    text-shadow: 0 0 8px rgba(255, 0, 0, 0.8);
    outline: none;
  }

  /* Ensure dropdown text is left aligned */
  .grid-dropdown a span {
    text-align: left;
    width: 100%;
  }

  /* Responsive Design */
  @media (max-width: 1200px) {
    .grid-menu-container {
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 4px;
    }
  }

  @media (max-width: 900px) {
    .grid-menu-container {
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 4px;
      padding: 0px;
    }
    
    .grid-menu-link {
      padding: 3px;
    }
    
    .grid-dropdown {
      z-index: 15000 !important;
    }
    
    .grid-menu-item.has-children:hover {
      z-index: 14999 !important;
    }
  }

  @media (max-width: 600px) {
    .grid-category-menu {
      width: 95%;
      background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.95) 0%,
        rgba(250, 250, 250, 0.98) 50%,
        rgba(255, 255, 255, 0.95) 100%
      ) !important;
      border-radius: 12px;
      margin: 16px auto 16px auto;
      padding: 10px 0;
      z-index: 500 !important;
    }
    
    .grid-menu-container {
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 4px;
      padding: 0px;
      overflow: visible !important;
    }
    
    .grid-menu-link {
      padding: 3px;
    }
    
    .grid-dropdown {
      background: linear-gradient(
        to bottom,
        rgba(60, 60, 60, 0.95) 0%,
        rgba(80, 80, 80, 0.98) 100%
      ) !important;
      z-index: 20000 !important;
      position: fixed !important;
      width: 90vw !important;
      max-width: 300px !important;
      left: 50% !important;
      transform: translateX(-50%) !important;
      margin-top: 5px !important;
    }
    
    .grid-dropdown:hover,
    .grid-menu-item.has-children:hover .grid-dropdown {
      transform: translateX(-50%) scale(1) !important;
    }
    
    .grid-menu-item.has-children:hover {
      z-index: 19999 !important;
    }
    
    .grid-dropdown a {
      padding: 8px 12px;
      font-size: 0.9em;
    }
  }

  /* Accessibility improvements */
  .grid-menu-link:focus-visible,
  .grid-dropdown a:focus-visible {
    outline: 2px solid #ff0000;
    outline-offset: 3px;
    box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
  }

  /* Z-INDEX HIERARCHY */
  .header,
  .header__wrapper,
  .header__inline-menu,
  .header-wrapper {
    position: relative;
    z-index: 100000 !important;
  }

  .mega-menu,
  .grid-category-menu {
    position: relative;
    z-index: 30000 !important;
  }

  .grid-menu-item:hover,
  .grid-menu-item:focus-within,
  .grid-menu-item.has-children:hover {
    z-index: 35000 !important;
  }

  .grid-dropdown {
    z-index: 40000 !important;
  }

  main,
  .main-content,
  .collection,
  .product-grid-container,
  #ProductGridContainer,
  .product-grid {
    position: relative;
    z-index: 1 !important;
  }

  .grid__item,
  .card-wrapper,
  .card__media,
  .card__content {
    position: relative;
    z-index: auto !important;
  }
{%- endstyle -%}

{% assign all_collections_array = collections | map: 'handle' %}
{% assign parent_collections = '' %}
{% assign all_parents_data = '' %}

{% comment %} Identify parent collections (no underscore in handle) {% endcomment %}
{% for handle in all_collections_array %}
  {% unless handle contains '_' %}
    {% assign collection = collections[handle] %}
    {% if collection.metafields.custom.show_in_menu == true %}
      {% assign order = collection.metafields.custom.order | default: 999 %}
      {% assign parent_collections = parent_collections | append: handle | append: ',' %}
      {% assign parent_data = handle | append: '|' | append: order %}
      {% assign all_parents_data = all_parents_data | append: parent_data | append: ',' %}
    {% endif %}
  {% endunless %}
{% endfor %}

{% comment %} Sort parents by order {% endcomment %}
{% assign parents_with_order = all_parents_data | split: ',' %}
{% assign sorted_parents = '' %}

{% comment %} Simple bubble sort for parent collections by order {% endcomment %}
{% for i in (1..99) %}
  {% assign lowest_order = 999 %}
  {% assign lowest_handle = '' %}
  
  {% for parent_data in parents_with_order %}
    {% if parent_data != blank %}
      {% assign parts = parent_data | split: '|' %}
      {% assign handle = parts[0] %}
      {% assign order = parts[1] | plus: 0 %}
      
      {% unless sorted_parents contains handle %}
        {% if order < lowest_order %}
          {% assign lowest_order = order %}
          {% assign lowest_handle = handle %}
        {% endif %}
      {% endunless %}
    {% endif %}
  {% endfor %}
  
  {% if lowest_handle != blank %}
    {% assign sorted_parents = sorted_parents | append: lowest_handle | append: ',' %}
  {% endif %}
  
  {% if sorted_parents contains lowest_handle %}
    {% continue %}
  {% endif %}
{% endfor %}

{% assign sorted_parents_array = sorted_parents | split: ',' %}

<nav class="grid-category-menu" role="navigation" aria-label="Category menu">
  <ul class="grid-menu-container">
    {% comment %} All Products Button {% endcomment %}
    <li class="grid-menu-item all-products">
      <a href="/collections/all" class="grid-menu-link">
        <span class="menu-text">ALL PRODUCTS</span>
      </a>
    </li>
    {% for parent_handle in sorted_parents_array %}
      {% if parent_handle != blank %}
        {% assign parent_collection = collections[parent_handle] %}
        {% if parent_collection %}
          {% comment %} Check if this parent has children {% endcomment %}
          {% assign has_children = false %}
          {% assign parent_prefix = parent_handle | append: '_' %}
          {% for handle in all_collections_array %}
            {% assign handle_start = handle | slice: 0, parent_prefix.size %}
            {% if handle_start == parent_prefix %}
              {% assign child_collection = collections[handle] %}
              {% if child_collection.metafields.custom.show_in_menu == true %}
                {% assign has_children = true %}
                {% break %}
              {% endif %}
            {% endif %}
          {% endfor %}
          
          <li class="grid-menu-item{% if has_children %} has-children{% endif %}" data-handle="{{ parent_handle }}" data-has-children="{{ has_children }}">
            <a href="{{ parent_collection.url }}" class="grid-menu-link">
              <span class="menu-text">
                {% if parent_collection.metafields.custom.display_name %}
                  {{ parent_collection.metafields.custom.display_name }}
                {% else %}
                  {{ parent_collection.title }}
                {% endif %}
                {% assign title_lower = parent_collection.title | downcase %}
                {% assign display_name_lower = parent_collection.metafields.custom.display_name | downcase %}
                {% if title_lower contains 'enfant' or title_lower contains 'child' or title_lower contains 'kid' or display_name_lower contains 'enfant' or display_name_lower contains 'child' or display_name_lower contains 'kid' %}
                  <span style="margin-left: 5px;">ðŸ§’</span>
                {% endif %}
              </span>
            </a>
            
            {% if has_children %}
              {% comment %} Find and sort child collections {% endcomment %}
              {% assign children_data = '' %}
              {% assign parent_prefix = parent_handle | append: '_' %}
              {% for handle in all_collections_array %}
                {% assign handle_start = handle | slice: 0, parent_prefix.size %}
                {% if handle_start == parent_prefix %}
                  {% assign child_collection = collections[handle] %}
                  {% if child_collection.metafields.custom.show_in_menu == true %}
                    {% assign child_order = child_collection.metafields.custom.order | default: 999 %}
                    {% assign child_data = handle | append: '|' | append: child_order %}
                    {% assign children_data = children_data | append: child_data | append: ',' %}
                  {% endif %}
                {% endif %}
              {% endfor %}
              
              {% if children_data != blank %}
                {% assign children_with_order = children_data | split: ',' %}
                {% assign sorted_children = '' %}
                
                {% comment %} Sort children by order {% endcomment %}
                {% for i in (1..50) %}
                  {% assign lowest_child_order = 999 %}
                  {% assign lowest_child_handle = '' %}
                  
                  {% for child_data in children_with_order %}
                    {% if child_data != blank %}
                      {% assign child_parts = child_data | split: '|' %}
                      {% assign child_handle = child_parts[0] %}
                      {% assign child_order = child_parts[1] | plus: 0 %}
                      
                      {% unless sorted_children contains child_handle %}
                        {% if child_order < lowest_child_order %}
                          {% assign lowest_child_order = child_order %}
                          {% assign lowest_child_handle = child_handle %}
                        {% endif %}
                      {% endunless %}
                    {% endif %}
                  {% endfor %}
                  
                  {% if lowest_child_handle != blank %}
                    {% assign sorted_children = sorted_children | append: lowest_child_handle | append: ',' %}
                  {% endif %}
                {% endfor %}
                
                {% assign sorted_children_array = sorted_children | split: ',' %}
                
                <ul class="grid-dropdown" role="menu">
                  {% for child_handle in sorted_children_array %}
                    {% if child_handle != blank %}
                      {% assign child_collection = collections[child_handle] %}
                      {% if child_collection %}
                        <li role="none">
                          <a href="{{ child_collection.url }}" role="menuitem">
                            <span>
                              {% if child_collection.metafields.custom.display_name %}
                                {{ child_collection.metafields.custom.display_name }}
                              {% else %}
                                {{ child_collection.title }}
                              {% endif %}
                              {% assign child_title_lower = child_collection.title | downcase %}
                              {% assign child_display_name_lower = child_collection.metafields.custom.display_name | downcase %}
                              {% if child_title_lower contains 'enfant' or child_title_lower contains 'child' or child_title_lower contains 'kid' or child_display_name_lower contains 'enfant' or child_display_name_lower contains 'child' or child_display_name_lower contains 'kid' %}
                                <span style="margin-left: 5px;">ðŸ§’</span>
                              {% endif %}
                            </span>
                          </a>
                        </li>
                      {% endif %}
                    {% endif %}
                  {% endfor %}
                </ul>
              {% endif %}
            {% endif %}
          </li>
        {% endif %}
      {% endif %}
    {% endfor %}
    
    {% comment %} Calculate remaining slots needed for 18 total (minus 1 for All Products) {% endcomment %}
    {% assign total_items = sorted_parents_array | size | plus: 1 %}
    {% assign remaining_slots = 18 | minus: total_items %}
    
    {% comment %} Fill empty slots {% endcomment %}
    {% for i in (1..remaining_slots) %}
      <li class="grid-menu-item empty-slot">
        <div class="grid-menu-link placeholder">
          <span class="menu-text">COMING SOON</span>
        </div>
      </li>
    {% endfor %}
  </ul>
</nav>

{% comment %} Promo Banner Section {% endcomment %}
<div class="promo-banner">
  <div class="promo-banner-content">
    <span class="promo-banner-text">
      NE RATEZ PAS NOTRE CODE PROMO
      <span class="promo-code-highlight">POWER5</span>
      BÃ‰NÃ‰FICIEZ DE 5% SUR LE SITE
    </span>
  </div>
</div>

{% comment %} Motorcycle Carousel Section - Now below the category menu {% endcomment %}
<div class="motorcycle-carousel">
  <div class="carousel-container">
    <div class="carousel-track">
      <div class="carousel-slide active">
        <img src="{{ 'BG_LRT.jpg' | asset_url }}" alt="Performance Motorcycles" loading="lazy">
        <div class="carousel-overlay">
          <h2 class="carousel-title" data-text="PERFORMANCE BIKES">PERFORMANCE BIKES</h2>
          <p class="carousel-subtitle">Unleash the power within</p>
        </div>
        <div class="info-container">
          <h2 class="panel-title">PERFORMANCE<br>BIKES</h2>
          <p class="panel-subtitle">Unleash the power within</p>
          <div class="panel-divider"></div>
          <h3 class="info-title">Expertise 2 Roues</h3>
          <div class="info-highlight">15+ ANS D'EXPÃ‰RIENCE</div>
          <ul class="info-list">
            <li>Banc de puissance 2T/4T</li>
          </ul>
          <p class="info-description">SpÃ©cialiste performances</p>
        </div>
      </div>
      <div class="carousel-slide">
        <img src="{{ 'BG_LRT2.jpg' | asset_url }}" alt="Street Machines" loading="lazy">
        <div class="carousel-overlay">
          <h2 class="carousel-title" data-text="STREET MACHINES">STREET MACHINES</h2>
          <p class="carousel-subtitle">Built for the urban warrior</p>
        </div>
        <div class="info-container">
          <h2 class="panel-title">STREET<br>MACHINES</h2>
          <p class="panel-subtitle">Built for the urban warrior</p>
          <div class="panel-divider"></div>
          <h3 class="info-title">Services Premium</h3>
          <div class="info-highlight">SUR RENDEZ-VOUS</div>
          <ul class="info-list">
            <li>Diagnostic Ã©lectronique</li>
          </ul>
          <p class="info-description">Toutes marques</p>
          <p class="info-description">Moto & Scooter</p>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Mobile menu handling
    let currentlyOpen = null;
    let mobileListeners = [];
    
    function setupMobileMenu() {
      // Clean up any existing listeners
      mobileListeners.forEach(({element, event, handler}) => {
        element.removeEventListener(event, handler);
      });
      mobileListeners = [];
      
      const menuItems = document.querySelectorAll('.grid-menu-item.has-children');
      
      menuItems.forEach(item => {
        const link = item.querySelector('.grid-menu-link');
        const dropdown = item.querySelector('.grid-dropdown');
        
        if (link && dropdown) {
          // Prevent default navigation on first click
          const clickHandler = function(e) {
            e.preventDefault();
            e.stopPropagation();
            
            // If this item is already open, navigate on second click
            if (item.classList.contains('mobile-active')) {
              window.location.href = link.href;
              return;
            }
            
            // Close previously opened item
            if (currentlyOpen && currentlyOpen !== item) {
              currentlyOpen.classList.remove('mobile-active');
            }
            
            // Open current item
            item.classList.add('mobile-active');
            currentlyOpen = item;
          };
          
          link.addEventListener('click', clickHandler);
          mobileListeners.push({element: link, event: 'click', handler: clickHandler});
        }
      });
      
      // Close dropdown when clicking outside
      const outsideClickHandler = function(e) {
        if (!e.target.closest('.grid-menu-item.has-children')) {
          if (currentlyOpen) {
            currentlyOpen.classList.remove('mobile-active');
            currentlyOpen = null;
          }
        }
      };
      
      document.addEventListener('click', outsideClickHandler);
      mobileListeners.push({element: document, event: 'click', handler: outsideClickHandler});
      
      // Close dropdown when clicking on child links
      const dropdownLinks = document.querySelectorAll('.grid-dropdown a');
      dropdownLinks.forEach(link => {
        const dropdownClickHandler = function() {
          if (currentlyOpen) {
            currentlyOpen.classList.remove('mobile-active');
            currentlyOpen = null;
          }
        };
        
        link.addEventListener('click', dropdownClickHandler);
        mobileListeners.push({element: link, event: 'click', handler: dropdownClickHandler});
      });
    }
    
    function cleanupMobileMenu() {
      // Remove all mobile-active classes
      document.querySelectorAll('.grid-menu-item.mobile-active').forEach(item => {
        item.classList.remove('mobile-active');
      });
      currentlyOpen = null;
      
      // Remove all mobile event listeners
      mobileListeners.forEach(({element, event, handler}) => {
        element.removeEventListener(event, handler);
      });
      mobileListeners = [];
    }
    
    // Check and setup based on current viewport
    function checkViewport() {
      const isMobile = window.matchMedia('(max-width: 768px)').matches;
      
      if (isMobile) {
        setupMobileMenu();
      } else {
        cleanupMobileMenu();
      }
    }
    
    // Initial setup
    checkViewport();
    
    // Handle window resize
    let resizeTimer;
    window.addEventListener('resize', function() {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(checkViewport, 250);
    });
    
    
    // Carousel functionality
    const carousel = document.querySelector('.motorcycle-carousel');
    if (!carousel) return;
    
    const track = carousel.querySelector('.carousel-track');
    const slides = carousel.querySelectorAll('.carousel-slide');
    // Auto-advance only - no manual controls
    let currentSlide = 0;
    
    function showSlide(index) {
      // Use transform to slide the track
      track.style.transform = `translateX(-${index * 50}%)`;
      currentSlide = index;
    }
    
    function nextSlide() {
      const next = (currentSlide + 1) % slides.length;
      showSlide(next);
    }
    
    function prevSlide() {
      const prev = (currentSlide - 1 + slides.length) % slides.length;
      showSlide(prev);
    }
    
    // Event listeners removed - auto-advance only
    
    // Dots and manual controls removed
    
    // Auto-advance carousel - slower interval for less distraction
    setInterval(nextSlide, 8000);
  });
</script>

{% comment %} Featured Categories Section - Matrix Animated {% endcomment %}
<section class="featured-categories">
  <h2 class="featured-categories-title" data-text="BEST SELLERS">BEST SELLERS</h2>
  <div class="featured-grid">
    <a href="/collections/manchons-lrt" class="featured-item">
      <img src="{{ 'Manchonv2.jpg' | asset_url }}" alt="Manchons LRT" loading="lazy">
    </a>
    <a href="/collections/boites-a-air" class="featured-item">
      <img src="{{ 'boite-a-airv2.jpg' | asset_url }}" alt="BoÃ®tes Ã  air" loading="lazy">
    </a>
    <a href="/collections/pipes-admission" class="featured-item">
      <img src="{{ 'pipe-admissionv2-1.jpg' | asset_url }}" alt="Pipes d'admission" loading="lazy">
    </a>
  </div>
</section>

{% comment %} Services Title Section {% endcomment %}
<h2 class="services-title" data-text="NOS SERVICES">NOS SERVICES</h2>

{% comment %} Company Information Section {% endcomment %}
<section class="company-section">
  <div class="company-intro">
    <p>SpÃ©cialiste de la performance 2 roues depuis plus de 15 ans, LRT Garage vous accompagne dans tous vos projets de personnalisation et d'amÃ©lioration de vos machines. SituÃ© au cÅ“ur de la CÃ´te d'Azur, notre atelier combine expertise technique et passion pour offrir le meilleur Ã  votre moto ou scooter.</p>
  </div>

  <div class="services-grid">
    <div class="service-card">
      <h3 class="service-title">Banc de Puissance</h3>
      <img class="service-image" src="{{ 'LRT-Services-4.jpeg' | asset_url }}" alt="Banc de Puissance" loading="lazy">
      <p class="service-description">RÃ©glage prÃ©cis de votre machine 2T sur banc de puissance. Mesure de puissance pour machines 4T. Optimisation des performances garantie.</p>
    </div>
    
    <div class="service-card">
      <h3 class="service-title">Usinage Moteur</h3>
      <img class="service-image" src="{{ 'LRT-Services-5.jpeg' | asset_url }}" alt="Usinage Moteur" loading="lazy">
      <p class="service-description">Culasse, modification rapport volumÃ©trique, passage vilebrequin/gros clapet, fraisage divers. Travail de prÃ©cision pour performances maximales.</p>
    </div>
    
    <div class="service-card">
      <h3 class="service-title">MÃ©trologie & Montage</h3>
      <img class="service-image" src="{{ 'LRT-Services-2.jpeg' | asset_url }}" alt="MÃ©trologie & Montage" loading="lazy">
      <p class="service-description">Service complet de mÃ©trologie et montage moteur. Ã‰tanchÃ©itÃ© parfaite et performance optimale. Expertise reconnue sur toutes marques.</p>
    </div>
    
    <div class="service-card">
      <h3 class="service-title">Diagnostic & Entretien</h3>
      <img class="service-image" src="{{ 'LRT-Services-1.jpeg' | asset_url }}" alt="Diagnostic & Entretien" loading="lazy">
      <p class="service-description">Diagnostic Ã©lectronique complet. Entretien pÃ©riodique et prÃ©paration compÃ©tition. Service rapide et professionnel sur rendez-vous.</p>
    </div>
  </div>

  <!-- Opening Hours Section -->
  <div class="opening-hours">
    <h3 class="hours-title">HORAIRES D'OUVERTURE</h3>
    <div class="hours-content">
      <p class="hours-text">LUNDI - VENDREDI: 9H00 - 18H30</p>
      <p class="hours-text">SAMEDI: 9H00 - 17H00</p>
      <p class="hours-text">DIMANCHE: FERMÃ‰</p>
    </div>
  </div>

  <div class="social-links">
    <a href="https://www.instagram.com/lrt_garage/?hl=fr" class="social-link" aria-label="Instagram" target="_blank" rel="noopener">
      <img src="{{ 'instagram.png' | asset_url }}" alt="Instagram" width="30" height="30">
    </a>
    <a href="https://www.tiktok.com/@lrtgarage06" class="social-link" aria-label="TikTok" target="_blank" rel="noopener">
      <img src="{{ 'tic-tac.png' | asset_url }}" alt="TikTok" width="30" height="30">
    </a>
    <a href="https://m.me/lrtgarage" class="social-link" aria-label="Messenger" target="_blank" rel="noopener">
      <img src="{{ 'messager.png' | asset_url }}" alt="Messenger" width="30" height="30">
    </a>
    <a href="https://www.snapchat.com/add/lrtgarage" class="social-link" aria-label="Snapchat" target="_blank" rel="noopener">
      <img src="{{ 'snapchat.png' | asset_url }}" alt="Snapchat" width="30" height="30">
    </a>
  </div>

  <!-- Help Button -->
  <div class="help-button-container">
    <button class="help-button" id="helpButton">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
      </svg>
      <span>Besoin d'aide?</span>
    </button>
  </div>
</section>