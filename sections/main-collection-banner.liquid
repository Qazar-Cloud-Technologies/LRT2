{% comment %}
Dynamic Grid Menu with Glass Effect and Motorcycle Theme
Includes carousel and collection navigation
All CSS integrated - no external stylesheet needed
{% endcomment %}

{%- style -%}
  /* Motorcycle Carousel Styles */
  .motorcycle-carousel {
    position: relative;
    width: 100%;
    height: 500px;
    overflow: hidden;
    background: #fff;
    margin-bottom: 40px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(0, 0, 0, 0.05);
  }
  
  .carousel-container {
    position: relative;
    width: 100%;
    height: 100%;
  }
  
  .carousel-track {
    display: flex;
    transition: transform 0.5s ease;
    height: 100%;
    width: 200%; /* Width for 2 slides */
  }
  
  .carousel-slide {
    position: relative;
    width: 50%; /* Each slide takes 50% of track width */
    height: 100%;
    flex-shrink: 0;
  }
  
  .carousel-slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }
  
  .carousel-overlay {
    position: absolute;
    bottom: 60px;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
    z-index: 2;
  }
  
  .carousel-title {
    font-family: monospace;
    font-size: 3rem;
    font-weight: 900;
    color: #ff0000;
    text-transform: uppercase;
    letter-spacing: 0.2em;
    margin: 0;
    text-shadow: 0 0 20px #ff0000, 0 0 40px #ff0000, 0 0 60px #ff0000;
    animation: glitch 2s infinite;
  }
  
  .carousel-subtitle {
    font-family: monospace;
    font-size: 1.2rem;
    color: #222;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-top: 10px;
    text-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
  }
  
  .carousel-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255, 0, 0, 0.1);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 0, 0, 0.3);
    color: #ff0000;
    font-size: 2rem;
    padding: 10px 20px;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 3;
  }
  
  .carousel-nav:hover {
    background: rgba(255, 0, 0, 0.2);
    box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
  }
  
  .carousel-prev {
    left: 20px;
  }
  
  .carousel-next {
    right: 20px;
  }
  
  .carousel-dots {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
    z-index: 3;
  }
  
  .carousel-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    border: 1px solid rgba(255, 0, 0, 0.5);
    cursor: pointer;
    transition: all 0.3s ease;
  }
  
  .carousel-dot.active {
    background: #ff0000;
    box-shadow: 0 0 10px #ff0000;
  }
  
  @media (max-width: 768px) {
    .motorcycle-carousel {
      height: 300px;
    }
    
    .carousel-title {
      font-size: 2rem;
    }
    
    .carousel-subtitle {
      font-size: 1rem;
    }
  }

  /* Mega Menu Styles with 95% width */
  
  /* Main container with enhanced glass effect */
  .grid-category-menu {
    width: 95%;
    padding: 16px 0;
    background: linear-gradient(
      135deg,
      rgba(20, 20, 20, 0.85) 0%,
      rgba(30, 30, 30, 0.9) 50%,
      rgba(20, 20, 20, 0.85) 100%
    );
    backdrop-filter: blur(30px) saturate(150%);
    -webkit-backdrop-filter: blur(30px) saturate(150%);
    border: 1px solid rgba(255, 0, 0, 0.2);
    border-radius: 20px;
    box-shadow: 
      0 12px 48px rgba(255, 0, 0, 0.15),
      0 4px 16px rgba(0, 0, 0, 0.4),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.1),
      inset 0 -1px 0 0 rgba(0, 0, 0, 0.5);
    margin: 0 auto 30px auto;
    position: relative;
    overflow: visible;
    z-index: 40000 !important;
  }

  /* Add Matrix-style overlay with red accent */
  .grid-category-menu::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(255, 0, 0, 0.03) 2px,
      rgba(255, 0, 0, 0.03) 4px
    );
    pointer-events: none;
    border-radius: 20px;
    opacity: 0.6;
    animation: matrix-scan 8s linear infinite;
  }

  @keyframes matrix-scan {
    0% { transform: translateY(0); }
    100% { transform: translateY(20px); }
  }

  /* Auto-fit grid with minimum item width and max 6 columns */
  .grid-menu-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    grid-auto-rows: minmax(auto, auto);
    gap: 4px;
    padding: 0px;
    margin: 0;
    list-style: none;
    position: relative;
    z-index: 10;
    overflow: visible;
  }

  /* Limit to maximum 6 columns */
  @media (min-width: 860px) {
    .grid-menu-container {
      grid-template-columns: repeat(6, 1fr);
    }
  }

  .grid-menu-item {
    position: relative;
    margin: 0;
    padding: 0;
    border-radius: 12px;
    min-width: 0;
    margin-bottom: 0;
  }

  /* Remove margin for items with children - dropdowns will overlay */
  .grid-menu-item.has-children {
    margin-bottom: 0;
  }

  /* Show dropdown on hover for items with children */
  .grid-menu-item.has-children:hover .grid-dropdown,
  .grid-menu-item.has-children:focus-within .grid-dropdown {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
    transform: translateY(0) scale(1);
  }

  /* Ensure hovered menu item is above others */
  .grid-menu-item.has-children:hover {
    z-index: 9999;
  }

  /* Create invisible bridge to maintain hover state */
  .grid-menu-item.has-children::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    height: 10px;
    z-index: 99;
  }

  /* Enhanced gradient animated button style with Matrix effect */
  .grid-menu-link {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: 12px 8px;
    color: #ffffff;
    text-decoration: none;
    font-size: inherit;
    font-weight: 700;
    text-transform: uppercase;
    border-radius: 14px;
    position: relative;
    overflow: hidden;
    
    /* Enhanced gradient animation */
    background: linear-gradient(
      135deg,
      rgba(255, 0, 0, 0.1) 0%,
      rgba(255, 0, 0, 0.2) 25%,
      rgba(0, 0, 0, 0.6) 50%,
      rgba(255, 0, 0, 0.2) 75%,
      rgba(255, 0, 0, 0.1) 100%
    );
    background-size: 300% 300%;
    animation: gradient-shift 10s ease infinite;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    
    /* Enhanced glass effect */
    backdrop-filter: blur(15px) brightness(1.1);
    -webkit-backdrop-filter: blur(15px) brightness(1.1);
    border: 1px solid rgba(255, 0, 0, 0.3);
    box-shadow: 
      0 4px 16px rgba(255, 0, 0, 0.1),
      0 2px 8px rgba(0, 0, 0, 0.3),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
  }

  @keyframes gradient-shift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
  }

  /* All Products special styling */
  .grid-menu-item.all-products .grid-menu-link {
    background: linear-gradient(
      135deg,
      rgba(255, 0, 0, 0.3) 0%,
      rgba(255, 0, 0, 0.5) 50%,
      rgba(255, 0, 0, 0.3) 100%
    );
    border-color: rgba(255, 0, 0, 0.5);
    box-shadow: 
      0 4px 20px rgba(255, 0, 0, 0.3),
      0 2px 8px rgba(0, 0, 0, 0.4),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.2);
  }

  /* Empty slot styling */
  .grid-menu-item.empty-slot .placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: 12px 8px;
    color: rgba(255, 255, 255, 0.3);
    font-size: inherit;
    font-weight: 600;
    text-transform: uppercase;
    border-radius: 14px;
    background: rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px dashed rgba(255, 0, 0, 0.2);
    cursor: not-allowed;
    opacity: 0.5;
  }

  .grid-menu-link:hover,
  .grid-menu-link:focus {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 
      0 8px 32px rgba(255, 0, 0, 0.4),
      0 4px 16px rgba(0, 0, 0, 0.5),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.3),
      0 0 40px rgba(255, 0, 0, 0.3);
    border-color: rgba(255, 0, 0, 0.6);
    outline: none;
  }

  /* Matrix text effect on hover */
  .grid-menu-link::after {
    content: attr(data-text);
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #ff0000;
    opacity: 0;
    transition: opacity 0.3s ease;
    text-shadow: 0 0 10px #ff0000;
    pointer-events: none;
  }

  .grid-menu-link:hover::after {
    opacity: 0.1;
    animation: glitch-text 0.5s infinite;
  }

  @keyframes glitch-text {
    0%, 100% { transform: translate(0); }
    33% { transform: translate(-2px, -2px); }
    66% { transform: translate(2px, 2px); }
  }

  /* Active state */
  .grid-menu-link:active {
    transform: translateY(0);
    box-shadow: 
      0 2px 8px rgba(0, 0, 0, 0.08),
      inset 0 1px 2px rgba(0, 0, 0, 0.1);
  }

  .menu-text {
    font-size: 0.9em;
    letter-spacing: 1px;
    white-space: nowrap;
    line-height: 1.4;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: center;
    font-family: monospace, 'Courier New', Courier;
    text-shadow: 0 0 5px rgba(255, 0, 0, 0.3);
    position: relative;
    z-index: 2;
  }

  /* Enhanced glass dropdown with Matrix styling */
  .grid-dropdown {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    width: 100%;
    z-index: 50000 !important;
    max-height: 300px;
    overflow-y: auto;
    background: linear-gradient(
      to bottom,
      rgba(20, 20, 20, 0.95) 0%,
      rgba(30, 30, 30, 0.98) 100%
    );
    backdrop-filter: blur(30px) brightness(0.9);
    -webkit-backdrop-filter: blur(30px) brightness(0.9);
    box-shadow: 
      0 12px 48px rgba(255, 0, 0, 0.2),
      0 4px 16px rgba(0, 0, 0, 0.6),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.1);
    border-radius: 14px;
    border: 1px solid rgba(255, 0, 0, 0.3);
    list-style: none;
    padding: 8px;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transform: translateY(-5px) scale(0.98);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    scrollbar-width: thin;
    scrollbar-color: rgba(255, 0, 0, 0.3) transparent;
  }

  /* Custom scrollbar for webkit browsers */
  .grid-dropdown::-webkit-scrollbar {
    width: 6px;
  }

  .grid-dropdown::-webkit-scrollbar-track {
    background: transparent;
  }

  .grid-dropdown::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.2);
    border-radius: 3px;
  }

  .grid-dropdown::-webkit-scrollbar-thumb:hover {
    background-color: rgba(0, 0, 0, 0.3);
  }

  .grid-dropdown li {
    margin: 0 0 2px 0;
    padding: 0;
  }

  .grid-dropdown li:last-child {
    margin-bottom: 0;
  }

  .grid-dropdown a {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 10px 12px;
    color: #ffffff;
    text-decoration: none;
    font-size: 0.85em;
    font-weight: 600;
    text-transform: uppercase;
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.05);
    transition: all 0.2s ease;
    white-space: nowrap;
    font-family: monospace, 'Courier New', Courier;
    border: 1px solid transparent;
    text-shadow: 0 0 3px rgba(255, 0, 0, 0.2);
  }

  .grid-dropdown a:hover,
  .grid-dropdown a:focus {
    background: linear-gradient(
      to right,
      rgba(255, 0, 0, 0.3),
      rgba(255, 0, 0, 0.5)
    );
    color: #fff;
    transform: translateX(6px);
    box-shadow: 
      0 4px 16px rgba(255, 0, 0, 0.4),
      inset 0 1px 0 0 rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 0, 0, 0.5);
    text-shadow: 0 0 8px rgba(255, 0, 0, 0.8);
    outline: none;
  }

  /* Ensure dropdown text is left aligned */
  .grid-dropdown a span {
    text-align: left;
    width: 100%;
  }

  /* Responsive Design */
  @media (max-width: 1200px) {
    .grid-menu-container {
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 4px;
    }
  }

  @media (max-width: 900px) {
    .grid-menu-container {
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 4px;
      padding: 0px;
    }
    
    .grid-menu-link {
      padding: 3px;
    }
    
    .grid-dropdown {
      z-index: 20000 !important;
    }
    
    .grid-menu-item.has-children:hover {
      z-index: 19999 !important;
    }
  }

  @media (max-width: 600px) {
    .grid-category-menu {
      width: 95%;
      border-radius: 12px;
      margin: 0 auto 16px auto;
      padding: 10px 0;
      z-index: 500 !important;
    }
    
    .grid-menu-container {
      grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
      gap: 4px;
      padding: 0px;
      overflow: visible !important;
    }
    
    .grid-menu-link {
      padding: 3px;
    }
    
    .grid-dropdown {
      z-index: 30000 !important;
      position: fixed !important;
      width: 90vw !important;
      max-width: 300px !important;
      left: 50% !important;
      transform: translateX(-50%) !important;
      margin-top: 5px !important;
    }
    
    .grid-dropdown:hover,
    .grid-menu-item.has-children:hover .grid-dropdown {
      transform: translateX(-50%) scale(1) !important;
    }
    
    .grid-menu-item.has-children:hover {
      z-index: 29999 !important;
    }
    
    .grid-dropdown a {
      padding: 8px 12px;
      font-size: 0.9em;
    }
  }

  /* Accessibility improvements */
  .grid-menu-link:focus-visible,
  .grid-dropdown a:focus-visible {
    outline: 2px solid #ff0000;
    outline-offset: 3px;
    box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
  }

  /* Z-INDEX HIERARCHY */
  .header,
  .header__wrapper,
  .header__inline-menu {
    position: relative;
    z-index: 35000 !important;
  }

  .mega-menu,
  .grid-category-menu {
    position: relative;
    z-index: 40000 !important;
  }

  .grid-menu-item:hover,
  .grid-menu-item:focus-within,
  .grid-menu-item.has-children:hover {
    z-index: 45000 !important;
  }

  .grid-dropdown {
    z-index: 50000 !important;
  }

  main,
  .main-content,
  .collection,
  .product-grid-container,
  #ProductGridContainer,
  .product-grid {
    position: relative;
    z-index: 1 !important;
  }

  .grid__item,
  .card-wrapper,
  .card__media,
  .card__content {
    position: relative;
    z-index: auto !important;
  }
{%- endstyle -%}

{% comment %} Motorcycle Carousel Section {% endcomment %}
<div class="motorcycle-carousel">
  <div class="carousel-container">
    <div class="carousel-track">
      <div class="carousel-slide active">
        <img src="{{ 'BG_LRT.jpg' | asset_url }}" alt="Performance Motorcycles" loading="lazy">
        <div class="carousel-overlay">
          <h2 class="carousel-title" data-text="PERFORMANCE BIKES">PERFORMANCE BIKES</h2>
          <p class="carousel-subtitle">Unleash the power within</p>
        </div>
      </div>
      <div class="carousel-slide">
        <img src="{{ 'BG_LRT2.jpg' | asset_url }}" alt="Street Machines" loading="lazy">
        <div class="carousel-overlay">
          <h2 class="carousel-title" data-text="STREET MACHINES">STREET MACHINES</h2>
          <p class="carousel-subtitle">Built for the urban warrior</p>
        </div>
      </div>
    </div>
    <button class="carousel-nav carousel-prev" aria-label="Previous slide">‹</button>
    <button class="carousel-nav carousel-next" aria-label="Next slide">›</button>
    <div class="carousel-dots">
      <button class="carousel-dot active" aria-label="Slide 1" data-slide="0"></button>
      <button class="carousel-dot" aria-label="Slide 2" data-slide="1"></button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.querySelector('.motorcycle-carousel');
    if (!carousel) return;
    
    const track = carousel.querySelector('.carousel-track');
    const slides = carousel.querySelectorAll('.carousel-slide');
    const dots = carousel.querySelectorAll('.carousel-dot');
    const prevBtn = carousel.querySelector('.carousel-prev');
    const nextBtn = carousel.querySelector('.carousel-next');
    let currentSlide = 0;
    
    function showSlide(index) {
      dots.forEach(dot => dot.classList.remove('active'));
      
      // Use transform to slide the track
      track.style.transform = `translateX(-${index * 50}%)`;
      dots[index].classList.add('active');
      currentSlide = index;
    }
    
    function nextSlide() {
      const next = (currentSlide + 1) % slides.length;
      showSlide(next);
    }
    
    function prevSlide() {
      const prev = (currentSlide - 1 + slides.length) % slides.length;
      showSlide(prev);
    }
    
    prevBtn.addEventListener('click', prevSlide);
    nextBtn.addEventListener('click', nextSlide);
    
    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => showSlide(index));
    });
    
    // Auto-advance carousel
    setInterval(nextSlide, 5000);
  });
</script>

{% assign all_collections_array = collections | map: 'handle' %}
{% assign parent_collections = '' %}
{% assign all_parents_data = '' %}

{% comment %} Identify parent collections (no underscore in handle) {% endcomment %}
{% for handle in all_collections_array %}
  {% unless handle contains '_' %}
    {% assign collection = collections[handle] %}
    {% if collection.metafields.custom.show_in_menu == true %}
      {% assign order = collection.metafields.custom.order | default: 999 %}
      {% assign parent_collections = parent_collections | append: handle | append: ',' %}
      {% assign parent_data = handle | append: '|' | append: order %}
      {% assign all_parents_data = all_parents_data | append: parent_data | append: ',' %}
    {% endif %}
  {% endunless %}
{% endfor %}

{% comment %} Sort parents by order {% endcomment %}
{% assign parents_with_order = all_parents_data | split: ',' %}
{% assign sorted_parents = '' %}

{% comment %} Simple bubble sort for parent collections by order {% endcomment %}
{% for i in (1..99) %}
  {% assign lowest_order = 999 %}
  {% assign lowest_handle = '' %}
  
  {% for parent_data in parents_with_order %}
    {% if parent_data != blank %}
      {% assign parts = parent_data | split: '|' %}
      {% assign handle = parts[0] %}
      {% assign order = parts[1] | plus: 0 %}
      
      {% unless sorted_parents contains handle %}
        {% if order < lowest_order %}
          {% assign lowest_order = order %}
          {% assign lowest_handle = handle %}
        {% endif %}
      {% endunless %}
    {% endif %}
  {% endfor %}
  
  {% if lowest_handle != blank %}
    {% assign sorted_parents = sorted_parents | append: lowest_handle | append: ',' %}
  {% endif %}
  
  {% if sorted_parents contains lowest_handle %}
    {% continue %}
  {% endif %}
{% endfor %}

{% assign sorted_parents_array = sorted_parents | split: ',' %}

<nav class="grid-category-menu" role="navigation" aria-label="Category menu">
  <ul class="grid-menu-container">
    {% comment %} All Products Button {% endcomment %}
    <li class="grid-menu-item all-products">
      <a href="/collections/all" class="grid-menu-link">
        <span class="menu-text">ALL PRODUCTS</span>
      </a>
    </li>
    {% for parent_handle in sorted_parents_array %}
      {% if parent_handle != blank %}
        {% assign parent_collection = collections[parent_handle] %}
        {% if parent_collection %}
          {% comment %} Check if this parent has children {% endcomment %}
          {% assign has_children = false %}
          {% assign parent_prefix = parent_handle | append: '_' %}
          {% for handle in all_collections_array %}
            {% assign handle_start = handle | slice: 0, parent_prefix.size %}
            {% if handle_start == parent_prefix %}
              {% assign child_collection = collections[handle] %}
              {% if child_collection.metafields.custom.show_in_menu == true %}
                {% assign has_children = true %}
                {% break %}
              {% endif %}
            {% endif %}
          {% endfor %}
          
          <li class="grid-menu-item{% if has_children %} has-children{% endif %}">
            <a href="{{ parent_collection.url }}" class="grid-menu-link">
              <span class="menu-text">
                {% if parent_collection.metafields.custom.display_name %}
                  {{ parent_collection.metafields.custom.display_name }}
                {% else %}
                  {{ parent_collection.title }}
                {% endif %}
              </span>
            </a>
            
            {% if has_children %}
              {% comment %} Find and sort child collections {% endcomment %}
              {% assign children_data = '' %}
              {% assign parent_prefix = parent_handle | append: '_' %}
              {% for handle in all_collections_array %}
                {% assign handle_start = handle | slice: 0, parent_prefix.size %}
                {% if handle_start == parent_prefix %}
                  {% assign child_collection = collections[handle] %}
                  {% if child_collection.metafields.custom.show_in_menu == true %}
                    {% assign child_order = child_collection.metafields.custom.order | default: 999 %}
                    {% assign child_data = handle | append: '|' | append: child_order %}
                    {% assign children_data = children_data | append: child_data | append: ',' %}
                  {% endif %}
                {% endif %}
              {% endfor %}
              
              {% if children_data != blank %}
                {% assign children_with_order = children_data | split: ',' %}
                {% assign sorted_children = '' %}
                
                {% comment %} Sort children by order {% endcomment %}
                {% for i in (1..50) %}
                  {% assign lowest_child_order = 999 %}
                  {% assign lowest_child_handle = '' %}
                  
                  {% for child_data in children_with_order %}
                    {% if child_data != blank %}
                      {% assign child_parts = child_data | split: '|' %}
                      {% assign child_handle = child_parts[0] %}
                      {% assign child_order = child_parts[1] | plus: 0 %}
                      
                      {% unless sorted_children contains child_handle %}
                        {% if child_order < lowest_child_order %}
                          {% assign lowest_child_order = child_order %}
                          {% assign lowest_child_handle = child_handle %}
                        {% endif %}
                      {% endunless %}
                    {% endif %}
                  {% endfor %}
                  
                  {% if lowest_child_handle != blank %}
                    {% assign sorted_children = sorted_children | append: lowest_child_handle | append: ',' %}
                  {% endif %}
                {% endfor %}
                
                {% assign sorted_children_array = sorted_children | split: ',' %}
                
                <ul class="grid-dropdown" role="menu">
                  {% for child_handle in sorted_children_array %}
                    {% if child_handle != blank %}
                      {% assign child_collection = collections[child_handle] %}
                      {% if child_collection %}
                        <li role="none">
                          <a href="{{ child_collection.url }}" role="menuitem">
                            <span>
                              {% if child_collection.metafields.custom.display_name %}
                                {{ child_collection.metafields.custom.display_name }}
                              {% else %}
                                {{ child_collection.title }}
                              {% endif %}
                            </span>
                          </a>
                        </li>
                      {% endif %}
                    {% endif %}
                  {% endfor %}
                </ul>
              {% endif %}
            {% endif %}
          </li>
        {% endif %}
      {% endif %}
    {% endfor %}
    
    {% comment %} Calculate remaining slots needed for 18 total (minus 1 for All Products) {% endcomment %}
    {% assign total_items = sorted_parents_array | size | plus: 1 %}
    {% assign remaining_slots = 18 | minus: total_items %}
    
    {% comment %} Fill empty slots {% endcomment %}
    {% for i in (1..remaining_slots) %}
      <li class="grid-menu-item empty-slot">
        <div class="grid-menu-link placeholder">
          <span class="menu-text">COMING SOON</span>
        </div>
      </li>
    {% endfor %}
  </ul>
</nav>